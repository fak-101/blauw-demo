---
import '../styles/landing.css';
---
<section class="landing">
  <div class="landing-container">
    <h1 class="landing-title" id="landing-title">BLAUW</h1>
    <div class="landing-content">
      <div class="landing-cta animate-on-scroll animate-once" data-delay="300">
        <div class="landing-arrow">â†“</div>
      </div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const landingTitle = document.getElementById('landing-title') as HTMLElement;
    const landingContent = document.querySelector('.landing-content') as HTMLElement;
    const headerLogo = document.querySelector('.header-logo') as HTMLElement;
    const landingSection = document.querySelector('.landing') as HTMLElement;
    const headerNav = document.querySelector('.header-nav') as HTMLElement;
    
    if (!landingTitle || !landingContent || !headerLogo || !landingSection) return;
    
    let isInHeader = false;
    let isFixed = false;
    let initialTitleSize = 0;
    let fixedStartTitleTop = 0;
    let fixedStartContentTop = 0;
    
    const updateInitialPosition = () => {
      initialTitleSize = parseFloat(getComputedStyle(landingTitle).fontSize);
    };
    
    setTimeout(() => {
      updateInitialPosition();
    }, 100);
    
    window.addEventListener('resize', updateInitialPosition);
    
    headerLogo.style.opacity = '0';
    headerLogo.style.transition = 'opacity 0.3s ease';
    
    window.addEventListener('scroll', () => {
      const scrollY = window.scrollY;
      const landingHeight = landingSection.offsetHeight;
      const headerHeight = headerNav?.offsetHeight || 80;
      
      const scrollProgress = Math.min(scrollY / landingHeight, 1);
      const headerProgress = Math.min(scrollProgress / 0.6, 1);
      
      if (scrollProgress > 0 && headerProgress < 1) {
        if (isInHeader) {
          isInHeader = false;
          landingTitle.style.display = 'block';
          landingContent.style.display = 'block';
        }
        
        if (!isFixed) {
          isFixed = true;
          if (initialTitleSize === 0) {
            updateInitialPosition();
          }
          
          const titleRect = landingTitle.getBoundingClientRect();
          const contentRect = landingContent.getBoundingClientRect();
          
          fixedStartTitleTop = titleRect.top + (titleRect.height / 2);
          fixedStartContentTop = contentRect.top;
          
          landingTitle.style.position = 'fixed';
          landingTitle.style.top = `${fixedStartTitleTop}px`;
          landingTitle.style.left = '50%';
          landingTitle.style.transform = 'translateX(-50%) translateY(-50%)';
          landingTitle.style.willChange = 'transform, top, font-size';
          landingTitle.style.zIndex = '101';
          
          landingContent.style.position = 'fixed';
          landingContent.style.top = `${fixedStartContentTop}px`;
          landingContent.style.left = '50%';
          landingContent.style.transform = 'translateX(-50%)';
          landingContent.style.willChange = 'transform, top';
          landingContent.style.zIndex = '101';
        }
        
        const startTitleY = fixedStartTitleTop;
        const endY = headerHeight / 2;
        const movement = (startTitleY - endY) * headerProgress;
        const currentTitleY = startTitleY - movement;
        
        const startContentY = fixedStartContentTop;
        const currentContentY = startContentY - movement;
        
        const startSize = initialTitleSize || parseFloat(getComputedStyle(landingTitle).fontSize);
        const endSize = parseFloat(getComputedStyle(headerLogo).fontSize);
        const currentSize = startSize - (startSize - endSize) * headerProgress;
        
        landingTitle.style.top = `${currentTitleY}px`;
        landingTitle.style.left = '50%';
        landingTitle.style.fontSize = `${currentSize}px`;
        landingTitle.style.zIndex = '101';
        landingTitle.style.transition = 'none';
        landingTitle.style.opacity = '1';
        
        landingContent.style.top = `${currentContentY}px`;
        landingContent.style.left = '50%';
        landingContent.style.zIndex = '101';
        landingContent.style.transition = 'none';
        
        if (scrollProgress > 0.4) {
          landingContent.style.opacity = '0';
        } else {
          landingContent.style.opacity = '1';
        }
        
        headerLogo.style.opacity = '0';
      } else if (headerProgress >= 1) {
        if (!isInHeader) {
          isInHeader = true;
          landingTitle.style.opacity = '0';
          landingTitle.style.display = 'none';
          landingContent.style.opacity = '0';
          landingContent.style.display = 'none';
          headerLogo.style.opacity = '1';
        }
      } else if (scrollProgress <= 0.01) {
        if (isInHeader) {
          isInHeader = false;
        }
        if (isFixed) {
          isFixed = false;
          landingTitle.style.willChange = 'auto';
          landingContent.style.willChange = 'auto';
        }
        landingTitle.style.position = 'relative';
        landingTitle.style.top = 'auto';
        landingTitle.style.left = 'auto';
        landingTitle.style.transform = 'none';
        landingTitle.style.fontSize = '';
        landingTitle.style.zIndex = '10';
        landingTitle.style.opacity = '1';
        landingTitle.style.display = 'block';
        
        landingContent.style.position = 'relative';
        landingContent.style.top = 'auto';
        landingContent.style.left = 'auto';
        landingContent.style.transform = 'none';
        landingContent.style.zIndex = '10';
        landingContent.style.opacity = '1';
        landingContent.style.display = 'block';
        
        headerLogo.style.opacity = '0';
        updateInitialPosition();
      }
    });
  });
</script>