---
import BlackBottle from '../assets/BlackBottle.png';
import PurpleBottle from '../assets/PurpleBottle.png';
import '../styles/product-info.css';
---
<section class="product-info">
  <div class="product-info-container">
    <h2 class="product-info-title animate-on-scroll">NUESTRAS BOTELLAS</h2>
    <p class="product-info-subtitle animate-on-scroll" data-delay="100">Conocé las principales características de nuestras botellas disponibles en diferentes colores:</p>
    
    <div class="carousel-wrapper">
      <div class="carousel-container" id="carousel-container">
        <div class="carousel-track" id="carousel-track">
          <!-- Duplicadas al inicio para efecto infinito -->
          <div class="material-panel" data-clone="start">
            <div class="material-image-wrapper">
              <img src={PurpleBottle.src} alt="Botella Violeta" class="material-image" />
            </div>
            <ul class="material-features">
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Leak proof:</strong> Diseñado para evitar derrames
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>BPA FREE:</strong> Fabricado sin químicos nocivos, seguro para la salud
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Eco-Friendly:</strong> Elaborado con materiales sostenibles para reducir el impacto ambiental
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Durabilidad:</strong> Resistente a golpes y caídas
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Inodoro e insípido:</strong> No altera el sabor ni el olor de las bebidas
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Resistencia a altas temperaturas:</strong> Soporta temperaturas de hasta 120°C y es apto para lavavajillas
                </div>
              </li>
            </ul>
          </div>
          
          <div class="material-panel" data-clone="start">
            <div class="material-image-wrapper">
              <img src={BlackBottle.src} alt="Botella Negra" class="material-image" />
            </div>
            <ul class="material-features">
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Leak proof:</strong> Diseñado para evitar derrames
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>BPA FREE:</strong> Fabricado sin químicos nocivos, seguro para la salud
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Eco-Friendly:</strong> Elaborado con materiales sostenibles para reducir el impacto ambiental
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Durabilidad:</strong> Resistente a golpes y caídas
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Inodoro e insípido:</strong> No altera el sabor ni el olor de las bebidas
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Resistencia a altas temperaturas:</strong> Soporta temperaturas de hasta 120°C y es apto para lavavajillas
                </div>
              </li>
            </ul>
          </div>
          
          <!-- Cards originales -->
          <div class="material-panel">
            <div class="material-image-wrapper">
              <img src={BlackBottle.src} alt="Botella Negra" class="material-image" />
            </div>
            <ul class="material-features">
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Leak proof:</strong> Diseñado para evitar derrames
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>BPA FREE:</strong> Fabricado sin químicos nocivos, seguro para la salud
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Eco-Friendly:</strong> Elaborado con materiales sostenibles para reducir el impacto ambiental
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Durabilidad:</strong> Resistente a golpes y caídas
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Inodoro e insípido:</strong> No altera el sabor ni el olor de las bebidas
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Resistencia a altas temperaturas:</strong> Soporta temperaturas de hasta 120°C y es apto para lavavajillas
                </div>
              </li>
            </ul>
          </div>
          
          <div class="material-panel">
            <div class="material-image-wrapper">
              <img src={PurpleBottle.src} alt="Botella Violeta" class="material-image" />
            </div>
            <ul class="material-features">
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Leak proof:</strong> Diseñado para evitar derrames
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>BPA FREE:</strong> Fabricado sin químicos nocivos, seguro para la salud
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Eco-Friendly:</strong> Elaborado con materiales sostenibles para reducir el impacto ambiental
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Durabilidad:</strong> Resistente a golpes y caídas
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Inodoro e insípido:</strong> No altera el sabor ni el olor de las bebidas
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Resistencia a altas temperaturas:</strong> Soporta temperaturas de hasta 120°C y es apto para lavavajillas
                </div>
              </li>
            </ul>
          </div>
          
          <div class="material-panel">
            <div class="material-image-wrapper">
              <img src={BlackBottle.src} alt="Botella Negra" class="material-image" />
            </div>
            <ul class="material-features">
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Leak proof:</strong> Diseñado para evitar derrames
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>BPA FREE:</strong> Fabricado sin químicos nocivos, seguro para la salud
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Eco-Friendly:</strong> Elaborado con materiales sostenibles para reducir el impacto ambiental
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Durabilidad:</strong> Resistente a golpes y caídas
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Inodoro e insípido:</strong> No altera el sabor ni el olor de las bebidas
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Resistencia a altas temperaturas:</strong> Soporta temperaturas de hasta 120°C y es apto para lavavajillas
                </div>
              </li>
            </ul>
          </div>
          
          <div class="material-panel">
            <div class="material-image-wrapper">
              <img src={PurpleBottle.src} alt="Botella Violeta" class="material-image" />
            </div>
            <ul class="material-features">
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Leak proof:</strong> Diseñado para evitar derrames
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>BPA FREE:</strong> Fabricado sin químicos nocivos, seguro para la salud
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Eco-Friendly:</strong> Elaborado con materiales sostenibles para reducir el impacto ambiental
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Durabilidad:</strong> Resistente a golpes y caídas
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Inodoro e insípido:</strong> No altera el sabor ni el olor de las bebidas
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Resistencia a altas temperaturas:</strong> Soporta temperaturas de hasta 120°C y es apto para lavavajillas
                </div>
              </li>
            </ul>
          </div>
          
          <!-- Duplicadas al final para efecto infinito -->
          <div class="material-panel" data-clone="end">
            <div class="material-image-wrapper">
              <img src={BlackBottle.src} alt="Botella Negra" class="material-image" />
            </div>
            <ul class="material-features">
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Leak proof:</strong> Diseñado para evitar derrames
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>BPA FREE:</strong> Fabricado sin químicos nocivos, seguro para la salud
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Eco-Friendly:</strong> Elaborado con materiales sostenibles para reducir el impacto ambiental
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Durabilidad:</strong> Resistente a golpes y caídas
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Inodoro e insípido:</strong> No altera el sabor ni el olor de las bebidas
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Resistencia a altas temperaturas:</strong> Soporta temperaturas de hasta 120°C y es apto para lavavajillas
                </div>
              </li>
            </ul>
          </div>
          
          <div class="material-panel" data-clone="end">
            <div class="material-image-wrapper">
              <img src={PurpleBottle.src} alt="Botella Violeta" class="material-image" />
            </div>
            <ul class="material-features">
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Leak proof:</strong> Diseñado para evitar derrames
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>BPA FREE:</strong> Fabricado sin químicos nocivos, seguro para la salud
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Eco-Friendly:</strong> Elaborado con materiales sostenibles para reducir el impacto ambiental
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Durabilidad:</strong> Resistente a golpes y caídas
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Inodoro e insípido:</strong> No altera el sabor ni el olor de las bebidas
                </div>
              </li>
              <li class="feature-item">
                <div class="feature-text">
                  <strong>Resistencia a altas temperaturas:</strong> Soporta temperaturas de hasta 120°C y es apto para lavavajillas
                </div>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <div class="carousel-dots" id="carousel-dots"></div>
    </div>
  </div>
</section>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const carouselTrack = document.getElementById('carousel-track') as HTMLElement;
    const carouselContainer = document.getElementById('carousel-container') as HTMLElement;
    const carouselDots = document.getElementById('carousel-dots') as HTMLElement;
    if (!carouselTrack || !carouselContainer || !carouselDots) return;
    
    const cards = carouselTrack.querySelectorAll('.material-panel:not([data-clone])');
    if (cards.length === 0) return;
    
    const originalCards = cards.length;
    const totalSlides = originalCards;
    const cloneCards = 2; // 2 clones al inicio
    let currentIndex = cloneCards; // Empezar en las cards originales (después de los 2 clones)
    let isDragging = false;
    let startX = 0;
    let currentX = 0;
    let autoSlideInterval: number | null = null;
    
    // Crear dots
    for (let i = 0; i < totalSlides; i++) {
      const dot = document.createElement('button');
      dot.className = 'carousel-dot';
      if (i === 0) dot.classList.add('active');
      dot.setAttribute('aria-label', `Ir a slide ${i + 1}`);
      dot.addEventListener('click', () => goToSlide(i));
      carouselDots.appendChild(dot);
    }
    
    const getCardWidth = () => {
      const containerWidth = carouselContainer.offsetWidth;
      return containerWidth;
    };
    
    let translateX = 0;
    
    const getCurrentSlide = () => {
      // Calcular el slide basado en currentIndex, ajustando por los clones
      let adjustedIndex = currentIndex - cloneCards;
      if (adjustedIndex < 0) {
        adjustedIndex = originalCards + adjustedIndex;
      }
      if (adjustedIndex >= originalCards) {
        adjustedIndex = adjustedIndex % originalCards;
      }
      return adjustedIndex;
    };
    
    const updateDots = () => {
      const dots = carouselDots.querySelectorAll('.carousel-dot');
      const currentSlide = getCurrentSlide();
      dots.forEach((dot, index) => {
        if (index === currentSlide) {
          dot.classList.add('active');
        } else {
          dot.classList.remove('active');
        }
      });
    };
    
    const updateCarousel = (smooth = true) => {
      const cardWidth = getCardWidth();
      translateX = -(currentIndex * cardWidth);
      
      if (smooth) {
        carouselTrack.style.transition = 'transform 0.5s ease-in-out';
      } else {
        carouselTrack.style.transition = 'none';
      }
      
      carouselTrack.style.transform = `translateX(${translateX}px)`;
      updateDots();
    };
    
    const checkInfinite = () => {
      // Si estamos en los clones del final, saltar a los originales
      if (currentIndex >= originalCards + cloneCards) {
        currentIndex = cloneCards;
        updateCarousel(false);
      }
      // Si estamos en los clones del inicio, saltar a los originales del final
      else if (currentIndex < cloneCards) {
        currentIndex = originalCards + cloneCards - 1;
        updateCarousel(false);
      }
    };
    
    const goToSlide = (slideIndex: number) => {
      currentIndex = cloneCards + slideIndex;
      updateCarousel(true);
      resetAutoSlide();
    };
    
    const nextSlide = () => {
      currentIndex++;
      updateCarousel(true);
      setTimeout(() => {
        checkInfinite();
      }, 500);
    };
    
    const prevSlide = () => {
      currentIndex--;
      updateCarousel(true);
      setTimeout(() => {
        checkInfinite();
      }, 500);
    };
    
    const startAutoSlide = () => {
      if (autoSlideInterval) clearInterval(autoSlideInterval);
      autoSlideInterval = window.setInterval(() => {
        if (!isDragging) {
          nextSlide();
        }
      }, 4000);
    };
    
    const resetAutoSlide = () => {
      startAutoSlide();
    };
    
    const stopAutoSlide = () => {
      if (autoSlideInterval) {
        clearInterval(autoSlideInterval);
        autoSlideInterval = null;
      }
    };
    
    // Mouse events
    const handleMouseDown = (e: MouseEvent) => {
      isDragging = true;
      startX = e.clientX;
      stopAutoSlide();
      carouselTrack.style.transition = 'none';
    };
    
    const handleMouseMove = (e: MouseEvent) => {
      if (!isDragging) return;
      e.preventDefault();
      currentX = e.clientX;
      const diff = currentX - startX;
      const cardWidth = getCardWidth();
      const baseOffset = currentIndex * cardWidth;
      translateX = -baseOffset + diff;
      carouselTrack.style.transform = `translateX(${translateX}px)`;
    };
    
    const handleMouseUp = () => {
      if (!isDragging) return;
      isDragging = false;
      
      const diff = currentX - startX;
      const threshold = 50;
      
      if (Math.abs(diff) > threshold) {
        if (diff > 0) {
          prevSlide();
        } else {
          nextSlide();
        }
      } else {
        updateCarousel(true);
        setTimeout(() => {
          checkInfinite();
        }, 500);
      }
      
      resetAutoSlide();
    };
    
    // Touch events
    const handleTouchStart = (e: TouchEvent) => {
      isDragging = true;
      startX = e.touches[0].clientX;
      stopAutoSlide();
      carouselTrack.style.transition = 'none';
    };
    
    const handleTouchMove = (e: TouchEvent) => {
      if (!isDragging) return;
      currentX = e.touches[0].clientX;
      const diff = currentX - startX;
      const cardWidth = getCardWidth();
      const baseOffset = currentIndex * cardWidth;
      translateX = -baseOffset + diff;
      carouselTrack.style.transform = `translateX(${translateX}px)`;
    };
    
    const handleTouchEnd = () => {
      if (!isDragging) return;
      isDragging = false;
      
      const diff = currentX - startX;
      const threshold = 50;
      
      if (Math.abs(diff) > threshold) {
        if (diff > 0) {
          prevSlide();
        } else {
          nextSlide();
        }
      } else {
        updateCarousel(true);
        setTimeout(() => {
          checkInfinite();
        }, 500);
      }
      
      resetAutoSlide();
    };
    
    carouselContainer.addEventListener('mousedown', handleMouseDown);
    document.addEventListener('mousemove', handleMouseMove);
    document.addEventListener('mouseup', handleMouseUp);
    carouselContainer.addEventListener('touchstart', handleTouchStart, { passive: false });
    carouselContainer.addEventListener('touchmove', handleTouchMove, { passive: false });
    carouselContainer.addEventListener('touchend', handleTouchEnd);
    
    updateCarousel(false);
    window.addEventListener('resize', () => {
      updateCarousel(false);
    });
    startAutoSlide();
  });
</script>